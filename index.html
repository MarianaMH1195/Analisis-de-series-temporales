<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Detective de Datos - Aprende anÃ¡lisis de series temporales de forma interactiva">
    <title>ğŸ” Detective de Datos | AnÃ¡lisis de Series Temporales</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=Roboto+Mono:wght@400;500&display=swap"
        rel="stylesheet">

    <!-- Styles -->
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div class="app-container">
        <!-- ========================================
             HEADER
        ======================================== -->
        <header class="app-header">
            <div class="header-content">
                <div class="logo">
                    <span class="logo-icon">ğŸ”</span>
                    <span class="logo-text">Detective de Datos</span>
                    <span class="logo-subtitle">Caso Retail 2022</span>
                </div>
                <nav class="header-nav">
                    <button class="btn-icon" id="btnLeaderboard" title="ClasificaciÃ³n"
                        aria-label="Ver clasificaciÃ³n">ğŸ†</button>
                    <button class="btn-icon active" id="btnSound" title="Sonido"
                        aria-label="Alternar sonido">ğŸ”Š</button>
                    <button class="btn-icon" id="btnDarkMode" title="Modo Oscuro"
                        aria-label="Alternar modo oscuro">ğŸŒ™</button>
                    <button class="btn-icon" id="btnTutorial" title="Tutorial" aria-label="Ver tutorial">â“</button>
                    <button class="btn-icon" id="btnSettings" title="ConfiguraciÃ³n"
                        aria-label="ConfiguraciÃ³n">âš™ï¸</button>
                </nav>
            </div>
            <div class="progress-container">
                <div class="progress-wrapper" id="progressBar">
                    <div class="progress-line">
                        <div class="progress-line-fill" id="progressFill"></div>
                    </div>
                    <div class="progress-step active" data-phase="0">
                        <span>0</span>
                        <span class="progress-step-label">Briefing</span>
                    </div>
                    <div class="progress-step" data-phase="1">
                        <span>1</span>
                        <span class="progress-step-label">Tendencia</span>
                    </div>
                    <div class="progress-step" data-phase="2">
                        <span>2</span>
                        <span class="progress-step-label">Estacionalidad</span>
                    </div>
                    <div class="progress-step" data-phase="3">
                        <span>3</span>
                        <span class="progress-step-label">AnomalÃ­as</span>
                    </div>
                    <div class="progress-step" data-phase="4">
                        <span>4</span>
                        <span class="progress-step-label">ResoluciÃ³n</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- ========================================
             MAIN CONTENT
        ======================================== -->
        <main class="main-content">

            <!-- ========================================
                 SCREEN 1: MISSION SELECT
            ======================================== -->
            <div id="missionSelectScreen" class="mission-screen active">
                <!-- Player Stats Header -->
                <div class="player-stats-bar">
                    <div class="player-rank">
                        <div class="rank-icon" id="rankIcon">ğŸŒ±</div>
                        <div class="rank-info">
                            <h3>Rango Actual</h3>
                            <div class="rank-name" id="currentRank">Novato</div>
                        </div>
                    </div>

                    <div class="player-xp">
                        <div class="xp-label">
                            <span>Progreso de Nivel</span>
                            <span><span id="totalXP">0</span> XP / 1650</span>
                        </div>
                        <div class="xp-bar">
                            <div class="xp-fill" id="xpProgressFill" style="width: 0%"></div>
                        </div>
                    </div>

                    <div class="player-missions">
                        <div class="missions-count" id="missionsCompleted">0/7</div>
                        <div class="text-muted text-sm">Misiones</div>
                    </div>
                </div>

                <!-- Missions Grid -->
                <h2 class="section-title mb-lg">Expedientes Disponibles</h2>
                <div class="missions-grid" id="missionsGrid">
                    <!-- Injected by JS -->
                </div>

                <!-- Achievements Section -->
                <div class="achievements-section">
                    <h3>ğŸ… Medallas y Logros</h3>
                    <div class="achievements-container" id="achievementsContainer">
                        <!-- Injected by JS -->
                    </div>
                </div>
            </div>

            <!-- ========================================
                 SCREEN 2: MISSION PLAY
            ======================================== -->
            <div id="missionPlayScreen" class="mission-screen">
                <!-- Mission Header -->
                <div class="mission-play-header">
                    <button class="btn btn-secondary btn-sm" id="btnBackToMissions">
                        â† Volver
                    </button>
                    <div class="mission-play-title-group" style="flex: 1; margin-left: 1rem;">
                        <h1 id="missionPlayTitle">TÃ­tulo MisiÃ³n</h1>
                        <p class="mission-play-subtitle" id="missionPlaySubtitle">SubtÃ­tulo</p>
                    </div>
                    <div class="mission-play-meta">
                        <span class="mission-difficulty" id="missionPlayDifficulty">â­â­</span>
                        <span class="mission-icon" id="missionPlayIcon">ğŸ“¦</span>
                    </div>
                </div>

                <!-- Narrative Section -->
                <div class="mission-narrative">
                    <h3>ğŸ“ Briefing de la MisiÃ³n</h3>
                    <p id="missionNarrative">...</p>

                    <div class="mission-objectives mt-md">
                        <h4>Objetivos:</h4>
                        <ul id="missionObjectives"></ul>
                    </div>
                </div>

                <!-- Chart Section -->
                <section class="chart-section mb-xl">
                    <div class="chart-header">
                        <h3 class="chart-title">
                            <span>ğŸ“Š</span>
                            <span id="chartTitleText">Datos del Caso</span>
                        </h3>
                        <div class="chart-controls">
                            <button id="btnZoomIn" title="Acercar">ğŸ”+</button>
                            <button id="btnZoomOut" title="Alejar">ğŸ”-</button>
                            <button id="btnResetChart" title="Restablecer">â†»</button>
                        </div>
                    </div>
                    <div class="mission-chart-container">
                        <div class="mission-chart-wrapper">
                            <canvas id="missionChart"></canvas>
                        </div>
                    </div>
                </section>

                <!-- Question Section -->
                <div class="question-progress" id="questionProgress">Pregunta 1 de 3</div>

                <div id="questionContainer">
                    <!-- Question injected by JS -->
                </div>

                <!-- Footer Tools -->
                <div class="mission-footer mt-xl text-center">
                    <button class="btn btn-secondary" id="btnRecapNarrative"
                        onclick="document.querySelector('.mission-narrative').scrollIntoView({behavior: 'smooth'})">
                        ğŸ“œ Ver Briefing
                    </button>
                    <button class="btn btn-secondary" id="btnSandboxModeInline">
                        ğŸ§ª Abrir Sandbox
                    </button>
                </div>
            </div>

        </main>

        <!-- ========================================
             SCORE BAR
        ======================================== -->
        <div class="score-bar" id="scoreBar">
            <div class="score-item">
                <span>â±ï¸</span>
                <span>Tiempo:</span>
                <span class="score-item-value" id="scoreTime">0:00</span>
            </div>
            <div class="score-item">
                <span>â­</span>
                <span>PuntuaciÃ³n:</span>
                <span class="score-item-value" id="scorePoints">0</span>
            </div>
            <div class="score-item">
                <span>ğŸ’¡</span>
                <span>Pistas:</span>
                <span class="score-item-value" id="scoreHints">0/9</span>
            </div>
        </div>

        <!-- ========================================
             MODAL FEEDBACK
        ======================================== -->
        <div class="modal" id="feedbackModal">
            <div class="modal-backdrop" id="modalBackdrop"></div>
            <div class="modal-content">
                <div class="modal-icon" id="modalIcon">âœ…</div>
                <h3 id="modalTitle">Â¡Correcto!</h3>
                <p id="modalMessage">Has identificado el patrÃ³n correctamente.</p>
                <div class="modal-actions">
                    <button class="btn btn-primary" id="btnModalClose">Continuar</button>
                </div>
            </div>
        </div>

        <!-- ========================================
             LEADERBOARD MODAL
        ======================================== -->
        <div class="modal" id="leaderboardModal">
            <div class="modal-backdrop" id="leaderboardBackdrop"></div>
            <div class="modal-content" style="max-width: 600px;">
                <div class="modal-icon">ğŸ†</div>
                <h3>Tabla de ClasificaciÃ³n</h3>
                <div id="leaderboardContent" style="text-align: left; margin: 1rem 0;">
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="border-bottom: 2px solid var(--primary);">
                                <th style="padding: 0.75rem; text-align: center;">#</th>
                                <th style="padding: 0.75rem; text-align: left;">Nombre</th>
                                <th style="padding: 0.75rem; text-align: center;">Puntos</th>
                                <th style="padding: 0.75rem; text-align: center;">Tiempo</th>
                            </tr>
                        </thead>
                        <tbody id="leaderboardBody">
                            <!-- Populated by JS -->
                        </tbody>
                    </table>
                    <p id="leaderboardEmpty" class="text-muted text-center" style="margin-top: 1rem;">No hay
                        puntuaciones guardadas aÃºn.</p>
                </div>
                <div class="modal-actions">
                    <button class="btn btn-secondary" id="btnClearLeaderboard">ğŸ—‘ï¸ Limpiar</button>
                    <button class="btn btn-primary" id="btnCloseLeaderboard">Cerrar</button>
                </div>
            </div>
        </div>

        <!-- ========================================
             NAME INPUT MODAL
        ======================================== -->
        <div class="modal" id="nameModal">
            <div class="modal-backdrop"></div>
            <div class="modal-content">
                <div class="modal-icon">ğŸ‰</div>
                <h3>Â¡Felicidades!</h3>
                <p>Has completado el caso. Ingresa tu nombre para el ranking:</p>
                <div class="form-group" style="text-align: left;">
                    <input type="text" id="playerNameInput" class="form-input" placeholder="Tu nombre..."
                        maxlength="20">
                </div>
                <div class="modal-actions">
                    <button class="btn btn-secondary" id="btnSkipName">Omitir</button>
                    <button class="btn btn-primary" id="btnSaveName">Guardar</button>
                </div>
            </div>
        </div>

        <!-- ========================================
             MISSION COMPLETE MODAL
        ======================================== -->
        <div class="modal mission-complete-modal" id="missionCompleteModal">
            <div class="modal-backdrop"></div>
            <div class="modal-content">
                <div class="complete-celebration">ğŸ‰</div>
                <h2 id="completeMissionTitle">MisiÃ³n Completada</h2>

                <div class="complete-xp">
                    <h2>+<span id="completeXPEarned">0</span> XP</h2>
                    <p>Total: <span id="completeTotalXP">0</span> XP</p>
                </div>

                <div class="complete-stats">
                    <div class="complete-stat">
                        <div class="complete-stat-value" id="completeCorrectAnswers">0/0</div>
                        <div class="complete-stat-label">Aciertos</div>
                    </div>
                </div>

                <div class="complete-achievement">
                    <div class="complete-achievement-icon" id="completeAchievementIcon">ğŸ…</div>
                    <h3 class="complete-achievement-name" id="completeAchievementName">Logro</h3>
                    <p class="complete-achievement-desc" id="completeAchievementDesc">DescripciÃ³n</p>
                </div>

                <div class="complete-actions">
                    <button class="btn btn-secondary" id="btnMissionCompleteClose">Cerrar</button>
                    <button class="btn btn-primary" id="btnNextMission">Siguiente MisiÃ³n â†’</button>
                </div>
            </div>
        </div>

        <!-- ========================================
             SANDBOX MODAL
        ======================================== -->
        <div class="modal" id="sandboxModal">
            <div class="modal-backdrop" id="sandboxBackdrop"></div>
            <div class="modal-content" style="max-width: 800px; max-height: 90vh; overflow-y: auto;">
                <div class="modal-icon">ğŸ§ª</div>
                <h3>Modo Sandbox</h3>
                <p class="mb-lg">Explora los datos libremente sin restricciones del juego.</p>

                <div style="text-align: left;">
                    <!-- Chart Type Selector -->
                    <div class="form-group">
                        <label class="form-label">Tipo de VisualizaciÃ³n:</label>
                        <select id="sandboxChartType" class="form-select">
                            <option value="line">ğŸ“ˆ LÃ­nea (Serie Temporal)</option>
                            <option value="bar">ğŸ“Š Barras (AgregaciÃ³n Mensual)</option>
                            <option value="scatter">âš« Puntos (DispersiÃ³n)</option>
                        </select>
                    </div>

                    <!-- Overlays -->
                    <div class="form-group">
                        <label class="form-label">Capas adicionales:</label>
                        <div style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
                            <label
                                style="display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem 1rem; border: 1px solid var(--border-color); border-radius: var(--radius-md); cursor: pointer;">
                                <input type="checkbox" id="sandboxShowTrend"> ğŸ“ LÃ­nea de Tendencia
                            </label>
                            <label
                                style="display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem 1rem; border: 1px solid var(--border-color); border-radius: var(--radius-md); cursor: pointer;">
                                <input type="checkbox" id="sandboxShowMovingAvg"> ğŸ“‰ Media MÃ³vil (7 dÃ­as)
                            </label>
                            <label
                                style="display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem 1rem; border: 1px solid var(--border-color); border-radius: var(--radius-md); cursor: pointer;">
                                <input type="checkbox" id="sandboxShowAnomalies"> ğŸš¨ Marcar AnomalÃ­as
                            </label>
                        </div>
                    </div>

                    <!-- Date Range -->
                    <div class="form-group">
                        <label class="form-label">Rango de Datos:</label>
                        <div style="display: flex; gap: 1rem; align-items: center;">
                            <input type="date" id="sandboxStartDate" class="form-input" value="2022-01-01"
                                style="flex: 1;">
                            <span>hasta</span>
                            <input type="date" id="sandboxEndDate" class="form-input" value="2022-10-31"
                                style="flex: 1;">
                        </div>
                    </div>

                    <!-- Stats Display -->
                    <div id="sandboxStats" class="stats-grid" style="margin: 1.5rem 0;">
                        <div class="stat-card">
                            <div class="stat-icon">ğŸ“Š</div>
                            <div class="stat-label">Media</div>
                            <div class="stat-value" id="sandboxMean">--</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">ğŸ“ˆ</div>
                            <div class="stat-label">MÃ¡ximo</div>
                            <div class="stat-value" id="sandboxMax">--</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">ğŸ“‰</div>
                            <div class="stat-label">MÃ­nimo</div>
                            <div class="stat-value" id="sandboxMin">--</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">ğŸ“</div>
                            <div class="stat-label">Desv. EstÃ¡ndar</div>
                            <div class="stat-value" id="sandboxStd">--</div>
                        </div>
                    </div>

                    <!-- Chart Preview -->
                    <div
                        style="background: var(--gray-50); border-radius: var(--radius-md); padding: 1rem; margin: 1rem 0;">
                        <canvas id="sandboxChart" style="width: 100%; height: 300px;"></canvas>
                    </div>
                </div>

                <div class="modal-actions">
                    <button class="btn btn-secondary" id="btnExportSandboxData">ğŸ“¥ Exportar CSV</button>
                    <button class="btn btn-primary" id="btnCloseSandbox">Cerrar</button>
                </div>
            </div>
        </div>

    </div>

    <!-- ========================================
         SCRIPTS (CDN)
    ======================================== -->
    <!-- Chart.js 4.4 -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <!-- Chart.js Annotation Plugin -->
    <script
        src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3.0.1/dist/chartjs-plugin-annotation.min.js"></script>
    <!-- Anime.js -->
    <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
    <!-- Canvas Confetti -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.0/dist/confetti.browser.min.js"></script>
    <!-- Numeral.js -->
    <script src="https://cdn.jsdelivr.net/npm/numeral@2.0.6/numeral.min.js"></script>
    <!-- jsPDF for PDF export -->
    <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

    <!-- Mission System Data -->
    <script src="datasets.js"></script>
    <script src="missions.js"></script>
    <script src="mission-system.js"></script>

    <!-- Game Logic -->
    <script src="game-logic.js"></script>
</body>

</html>